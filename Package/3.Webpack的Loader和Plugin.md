## 1.Loader

### 1.1 Loader作用

> 把js和json外的其它文件转为Webpack可以识别的模块



### 1.2 Loader简介

#### 1.2.1 Loader类型

> <font color=green>**1.总类型**</font>
>
> **pre：** 前置loader
>
> **normal：** 普通loader
>
> **inline：** 内联loader
>
> **post：** 后置loader
>
> <font color=green>**2.默认类型**</font>
>
> 默认为normal类型
>
> <font color=green>**3.修改类型**</font>
>
> 配置时可以通过enforce修改<font color=red>**pre，normal，post**</font>类型。
>
> > <font color=blue>**举例：**</font>
> >
> > ```javascript
> > {
> >     enforce: 'post',
> >     test: /\.js$/,
> >     loader: 'loader'
> > }
> > ```

#### 1.2.2 Loader顺序

> <font color=green>**1.总顺序**</font>
>
> 类型顺序 > 配置顺序
>
> > <font color=blue>**举例：**</font>
> >
> > **<font color=blue>配置loader：```[A, B, C]```，执行顺序为：```C -> B -> A```</font>**
> >
> > **<font color=blue>配置loader：```[A(enforce: pre), B, C]```，执行顺序为 ```A -> C -> B```</font>**
>
> <font color=green>**2.类型顺序**</font>
>
> pre > noraml > inline > post
>
> <font color=green>**3.配置顺序**</font>
>
> 从右到左，从下到上（即配置的链表的逆序）

#### 1.2.3 Loader使用

> <font color=green>**1.配置Loader**</font>
>
> 在webpack.config.js中配置Loader将处理哪些类型的文件
>
> > **配置方法：** 见“Webpack学习记录”
>
> <font color=green>**2.内联Loader**</font>
>
> 在引入某个文件时指定使用的Loader
>
> > **内联方法：**
> >
> > * **Loader：** 多个Loader间用!隔开
> >
> > * **参数：** 和URL一样用?和&传参给Loader
> >
> > * **文件：** 文件和Loader间用!隔开
> >
> > * **优先级：** 类似于配置Loader中的enforce。
> >
> >   * **!：** 跳过普通Loader
> >
> >   * **-!：** 跳过前置Loader和普通Loader
> >
> >   * **!!：** 跳过前置Loader和普通Loader和后置Loader
>
> > <font color=blue>**举例：**</font>
> >
> > <font color=blue>**内联Loader在每次引入文件时使用，写的内容太多太分散，且不利于排查问题。不推荐使用。**</font>
> >
> > ```javascript
> > import test from 'B-loader!A-loader?mode=txt&type=run!./test.txt'
> > ```
>
> <font color=green>**3.脚手架Loader**</font>
>
> > **配置方法：** 了解即可
> >
> > ```javascript
> > webpack --module-bind jade-loader --module-bind 'css=style-loader!css-loader'
> > ```
> >
> > 对.jade和.css文件使用对应的loader



### 1.3 Loader开发

#### 1.3.1 Loader模式

> <font color=green>**1.开发Loader基本概念**</font>
>
> **函数：** Loader是一个函数，涉及this调用，不要使用箭头函数
>
> **函数参数：**
>
> * **content：** 文件内容
>
> * **map：** 代码映射
>
> * **meta：** 传递给下一个Loader的内容
>
> **链式调用：** 不论采用简洁模式还是普通模式，后续loader会通过callback或返回值获取前一个loader处理内容继续处理
>
> <font color=green>**2.同步Loader**</font>
>
> <font color=red>**注意：同步Loader中不应该存在异步操作**</font>
>
> * **简洁模式**
>
>   ```javascript
>   module.exports = function(content, map, meta) {
>       return content
>   }
>   ```
>
> * **普通模式**
>
>   ```javascript
>   module.exports = function(content, map, meta) {
>       this.callback(null, content, map, meta)
>   }
>   ```
>
> <font color=green>**3.异步Loader**</font>
>
> <font color=red>**注意：虽然异步Loader中有异步操作，但是链式调用时只有异步操作完成，才能继续链式调用**</font>
>
> * **简洁模式**
>
>   ```javascript
>   module.exports = function(content, map, meta) {
>       return new Promise((res) => {
>           setTimeout(() => {
>               res(content)
>           }, 1000)
>       })
>   }
>   ```
>
> * **普通模式**
>
>   ```javascript
>   module.exports = function(content, map, meta) {
>       const callback = this.async()
>       setTimeout(() => {
>           callback(content, map, meta)
>       }, 1000)
>   }
>   ```
>
> <font color=green>**3.Raw Loader**</font>
>
> * **用途：** Raw Loader配置raw为true即可，表示接收Buffer格式的文件二进制数据，通常用于处理图片，音视频等。
>
> * **模式：** 同步和异步模式Raw Loader都可以使用。
>
> ```javascript
> module.exports.raw = true
> module.exports = function(content, map, meta) {
> 	return content
> }
> ```
>
> <font color=green>**4.Pitch Loader**</font>
>
> * **用途：** Pitch Loader配置pitch为函数即可，表示提前执行pitch函数，可以用于中断链式调用中后续Loader的执行。
> * **模式：** 同步和异步模式Pitch Loader都可以使用。
> * **顺序：** 
>   * **Loader：** 链式调用Loader中，Loader按照链表逆序执行，Pitch按照链表顺序执行
>   * **Pitch：** Pitch先于Loader执行。Pitch一旦有返回值，立即执行上一个Pitch对应的Loader并终止链式调用。
>
> ```javascript
> module.exports.pitch = () => 'result' // 有返回值提前中断
> module.exports = function(content, map, meta) {
> 	return content
> }
> ```

