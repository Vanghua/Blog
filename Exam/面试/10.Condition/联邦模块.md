### 特点

> <font color=blue>**设计目的**</font>
>
> > 实现新的运行时代码共享方案
>
> <font color=blue>**同类技术**</font>
>
> > **构建时共享：** 依赖外部化(npm包)，gitsubmodule，monorepo
> >
> > **运行时共享：** 依赖外部化(umd包)，联邦模块
>
> <font color=blue>**技术选型**</font>
>
> > **Umd：** 
> >
> > *颗粒度：* UMD包无法控制颗粒度，外部模块通常完整导出。运行时下载内容过多。
> >
> > *额外配置：* 主模块需要额外配置。可能存在第三方库依赖版本冲突；使用react相关依赖时主模块必须转为external。
> >
> > **Npm：** 
> >
> > *耦合性：* NPM无法彻底解耦。外部模块更新时需要主模块升级并重新打包。
> >
> > **SubModule：** 
> >
> > *耦合性：* submodule无法彻底解耦。外部模块更新时需要主模块升级重新打包。
> >
> > **MonoRepo：**
> >
> > *权限控制：* 代码合并和提交是面向整个仓库，需要建立完善的权限控制机制。



### 问题

> <font color=red>**共享时：样式没有隔离**</font>
>
> > **问题：** 联邦模块不提供沙箱环境，同名样式会产生冲突。
>
> 
>
> <font color=red>**生产时：暴露模块需要修改公共配置**</font>
>
> > **问题：** 业务作为生产者，需要在webpack/vite配置中修改暴露模块。
> >
> > **解决：** 可以考虑在业务中配置overwrite，或者使用高阶组件在构建时自动注入配置。
>
> <font color=red>**生产时：暴露模块不支持treeshaking**</font>
>
> > **问题：** 不能确定暴露模块是否被使用，如果不跨应用，可以通过treeshaking确定是否编译模块。
>
> 
>
> <font color=red>**消费时：远程模块不支持直接跨技术栈**</font>
>
> > **问题：** react项目消费vue项目暴露模块。不能直接通过jsx模式使用。
> >
> > **解决：** vue3可以直接导出webComponent；vue2需要在react安装vue运行时；react中封装控件把命令时加载vue模块封装成jsx。
>
> <font color=red>**消费时：远程模块不支持直接跨打包工具**</font>
>
> > **问题：** vite可以解析webpack生成的远程模块，webpack无法解析vite生成的远程模块。
> >
> > **解决：** 消费者为webpack时会调用remoteEntry并注入webpack解析模块逻辑，添加一层插件把注入代码转成符合vite解析的代码。
>
> <font color=red>**消费时：远程模块不支持热更新**</font>
>
> > **问题：** 使用pmmmwh插件热更新的react项目在接入联邦模块不支持远程模块热更新。例如使用lerna+monorepo开发调试联邦模块时必须手动刷新消费者才能同步生产者的更新。
> >
> > **解决：** 安装新热更新插件解决：@module-federation/fmr或者single-react-refresh-plugin插件。
>
> <font color=red>**消费时：远程模块不支持直接自动升级**</font>
>
> > **问题：** 消费者使用的远程模块升级后需要在构建配置中更新remoteEntry文件指纹。
> >
> > **解决步骤一：** 不使用缓存(通过时间戳刷掉缓存)请求版本控制脚本。
> >
> > **解决步骤二：** 版本控制脚本是轻量级脚本，版本判断后请求remoteEntry，用文件指纹控制模块版本。



### 配置

> <font color=blue>**remoteEntry**</font>
>
> > **作用：** 描述远程模块路径；初始化共享模块
>
> <font color=blue>**eager配置：**</font>
>
> > **生产者：** 
> >
> > 描述在remoteEntry中同步或异步初始化共享依赖。
> >
> > **消费者：** 
> >
> > 描述在启动项目时是否把共享依赖加入打包。
> >
> > **协作模式：**
> >
> > *语义化方案：* 生产者指明同步，消费者把依赖加入打包。生产者指明异步，消费者把依赖作为请求加载。
> >
> > *非语义化方案*： 消费者把使用远程模块入口作为异步模块，异步传染导致后续文件加载相对入口全部变成异步。生产者指明同步异步不重要，因为加载remoteEntry时共享依赖已经准备好。
>
> <font color=blue>**singleton配置：**</font>
>
> > **含义：** 是否只允许存在一个版本的示例。
