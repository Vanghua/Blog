### 1.地图插入点优化

#### 1.1 方法

**分批插入：** 

> **方案：** 例如一万个点，分批次插入点，每轮插入1000个（但实际上地图上只有几千个点）。
>
> **缺点：** 只是做了加载时的优化，当用户滑动地图查看某个省份的点时，会非常卡顿。测试发现大概在个人笔记本上存在200个点进行滑动就会造成非常卡顿。

**点聚合：**

> **方案：** 类似于树形选择器，企业里面选择员工，先选部门，再选部门下的员工。在每个省份上只绘制一个点，标识该省份有多少个点。当地图层级改变的时候再展示对应省份或城市下面的点。
>
> **缺点：** 有些用户想要做那种数据大屏一样的效果，就是要将所有点枚举到地图上。这种方式无法保障性能。

**海量点库：**

> **方案：** 大部分主流地图都支持插入海量点，一般通过canvas实现。例如百度地图mapv，高德massMarks，leaflet也有引用的插件。



#### 1.2 canvas实现地图和svg实现地图的优缺点

**分辨率：** svg是矢量图，在缩放时不失真。canvas无法做到。

**操作方式：** svg相当于dom操作，使用比较灵活，css和js均可控制。canvas是命令式操作，只能使用js控制，并且没有事件处理器。



#### 1.3 目前主流地图框架例如百度地图，leaflet实现插入海量点实现思路是什么

* 目前正常向地图里添加点，例如百度或者高德都是在地图上覆盖一个div。

* 插入大量点一般用canvas处理，加一个图层在上面绘制点。

* canvas在处理大量数据时候也会有性能负担，未做深入了解（例如：图形学优化，使用工作线程来进行计算）

  

### 2.权限控制

#### 2.1 模型

* **用户—角色—权限：** 用户可以对应多个角色，一个角色可以对应多个权限。在登录时后端只需要返回用户对应的角色即可。

* **菜单—权限：** 可以自定义配置用户在某个菜单上的权限，例如编辑，查看，删除，新增权限。这个权限是在角色权限之上附加的。在进入某些有菜单权限的菜单时，也需要请求该用户在该菜单上的权限。

#### 2.2 实现

* **权限控制：** 使用异步路由，路由和权限绑定。在路由守卫中判断跳转url是否越权，越权则会进行重定向。
* **权限存储：** 用户相关信息存在状态管理器中（vuex）。
* **权限保护：** 用户在调用接口时后端会重新做一遍权限校验。防止被抓高权限的接口后越权调用接口。