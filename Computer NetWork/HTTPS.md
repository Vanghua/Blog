## 1.证书

### 1.1 CA的概念

> CA（Catificate Authority）是证书颁发机构，由一系列流程管理证书。

### 1.2 CA的工作流程

> * **登记：** CA验证证书申请者的身份，经营范围等信息。
> * **签发证书：** CA生成数字证书，用自己的私钥进行签名。
> * **发布证书：** CA发布数字证书给申请者。
> * **撤销证书：** 证书被盗用，证书过期，申请者信息变更等情景会导致CA撤销证书。
> * **管理证书：** CA负责维护证书，续期证书，吊销证书等操作。

### 1.3 CA签名证书和客户端验证证书的过程

> **签名证书**
>
> 1. CA使用哈希算法，输入证书内容，输出哈希值作为证书摘要
> 2. CA使用非对称加密



## 2.加密

### 2.1 非对称加密

#### 2.1.1 非对称加密工作过程

> 准备一对密钥，公钥用于加密，私钥用于解密。
>
> * **加密：** 公钥+数据输入加密算法，输出密文。
>
> * **解密：** 私钥+密文输入解密算法，输出数据。

#### 2.1.2 非对称加密工作场景（注：最新考虑非对称加密的工作场景应该围绕每个算法来说明）

> **安全通信**
>
> > A和B在网络中需要较安全的通信，可以借助两个非对称加密工作流实现可靠通信。并且我们目前并不清楚HTTPS协议。
> >
> > * **生成密钥：** A生成自己的私钥和公钥，B生成自己的私钥和公钥。
> > * **交换公钥：** A把自己的公钥传输给B，B把自己的公钥传输给A。
> > * **传输数据：** A用B的公钥加密数据传输给B，B用自己的私钥解密数据。同理B对A采用相同的策略通信。
> >
> > **<font color=red>注意：中间人攻击对这种做法的威胁很大</font>**
> >
> > * <font color=red>**生成密钥： 中间人生成自己的公钥和私钥。**</font>
> > * <font color=red>**拦截公钥： 中间人拦截交换公钥过程，记录通信双方的公钥。并将自己的公钥转发给通信双方。**</font>
> > * <font color=red>**拦截数据： 中间人拦截传输数据过程，用自己的私钥解密数据。可以选择监听通信，也可以篡改数据再用对方的公钥加密数据并转发给通信对象。**</font>
>
> **密钥交换**
>
> 

#### 2.1.3 非对称加密常用算法

##### 2.1.3.1 RSA

> **RSA工作过程**
>
> > * **生成乘积数：** 选择大质数p和q，通常用二进制表述，位数在1024位以上。根据大质数得到乘积数n=p*q。
> >
> > * **计算乘积数的欧拉函数：** 计算n的欧拉函数，得到小于等于n且和n互质的数的个数φ(n)。
> >   $$
> >   先因式分解 \ \ \ n = p_1^{k_1} \times p_2^{k_2} \times \ldots \times p_k^{k_k} \\
> >   再求欧拉函数。r表示因数p_i个数，k_i表示因数p_i的指数 \ \ \ \phi(n) = \prod_i^rp_i^{(k_i - 1)}(p_i - 1) \\
> >   对于n = p * q的欧拉函数很简单 \ \ \ \phi(n) = (p - 1) * (q - 1)
> >   $$
> >
> > * **生成指数：** 
> >
> >   * **生成公钥指数：** 公钥指数为e
> >     $$
> >     \left\{
> >     \begin{array}{l}
> >     \text{(1) } e \text{ 与 } \varphi(n) \text{ 互质} \\\\
> >     \text{(2) } 1 < e < \varphi(n)
> >     \end{array}
> >     \right.
> >     $$
> >     
> >
> >   * **生成私钥指数：** 私钥指数为d
> >     $$
> >     \left\{
> >     \begin{array}{l}
> >     e * d \equiv 1 \pmod{\varphi(n)}
> >      \\\\
> >     \text{(2) } 1 < d < \varphi(n)
> >     \end{array}
> >     \right.
> >     $$
> >
> > * **生成公钥和私钥：** 公钥是乘积数和指数组成的数对(n, e)，私钥是乘积数和指数组成的数对(n, d)
> >
> > * **加密和解密：** 把明文映射为数值M
> >   $$
> >   加密 \ \ C = M^e \ \% \ n\\
> >   解密 \ \ M = C^d \ \% \ n
> >   $$
> >
> > **<font color=purple>欧拉函数表示：“对于正整数n，小于等于n且和n互质的数的个数”</font>**
> >
> > **<font color=red>注意概念：公钥和私钥是数对，公钥指数和私钥指数不是公钥和私钥，使用公钥加密和私钥解密还必须使用乘积数n</font>**
>
> **RSA破解方法**
>
> > 快速因数分解是破解RSA私钥的主要思路
> >
> > * 私钥由(n, d)组成，只要计算出d即可。
> > * 计算d需要知道φ(n)和e。
> > * 计算e需要知道φ(n)。
> > * 计算φ(n)需要知道n。
> > * 计算n需要知道互质的p和q。
> >
> > <font color=red>**安全因素： RSA是否安全受制于生成的P和Q是否安全。破解需要对n做因数分解，找到互质的因数p和q。但是目前没有快速因数分解的算法，因此RSA的安全性可以得到保障。和众多生成随机数相关的算法面临的风险一样，随机质数的生成不能是伪随机数，否则面临被破解的风险。**</font>
>
> **RSA耗时问题**
>
> > 下面是对RSA耗时分析的简略说明，具体复杂度证明可以参考：https://blog.csdn.net/qq_41961459/article/details/105692297
> >
> > * **生成密钥过程：** 生成公钥和私钥时都要保证两个条件成立，要解同余方程和遍历素数。
> >   $$
> >   复杂度为 \ \ \ O(log^2{(P\times Q)})
> >   $$
> >   
> >
> > * **加密解密过程：** 指数计算过程可以使用快速幂优化，在每轮计算时都取一次模，避免最后对大数取模。由于最开始要求的互质数p和q可能有几千二进制位，这样导致公钥指数e和私钥指数d的二进制位也是几千位，这样在快速幂优化的最坏的情况下要做几千轮的乘积和取模运算。
> >   $$
> >   可以使用快速幂优化，遍历指数的二进制位，时间复杂度O(log_2n) \ \ \ x^{87} = x^{01010111} \\
> >   总共的复杂度为表达式比较复杂，详情见参考链接
> >   $$
>
> **RSA常用场景**
>
> > RSA只是生成了一对公钥和私钥，无法保证双端正常通信。通常用于以下场景。
> >
> > **数字签名：** 
> >
> > * 服务端用私钥和数据加密生成文本作为签名，传递给客户端。
> > * 客户端再发请求时携带签名，服务端收到签名后解密并校验。
> >
> > **加密数据：**
> >
> > * 前端登录时请求后端生成的公钥加密密码，后端将密码存入数据库。并且可以随时解密用户的密码。

##### 2.1.3.2 DH

> **DH工作过程**
>
> **DH常用场景**
>
> > 



#### 2.1.4 非对称加密总结

> **能够安全传输：** 两个非对称加密工作流可以确保数据安全传输
>
> **加密解密速度慢：** 非对称加密加密解密速度很慢不适合传输大数据（先做指数运算再做取模运算，指数运算可以用快速幂做优化）
>
> **易受中间人攻击：** 中间人攻击对两个非对称加密工作流威胁很大

